<html><body>  <button id="connectButton">Connect</button>  <button onclick="vairesult()">Add gcode line</button>  <button id="write" onclick="WriteSerial()">Execute gcode</button>   <button onclick="movexp()">X+</button>  <button onclick="movexm()">X-</button>  <button onclick="moveyp()">Y+</button>  <button onclick="moveym()">Y-</button>  <button onclick="movezp()">Z+</button>  <button onclick="movezm()">Z-</button>  	          <label>step:</label>        <select id="step" >          <option value="10">10</option>          <option value="1">1</option>          <option value="100">100</option>        </select><br>  X=<input type="range" min="0" max="500" step="1" value="0" onclick='vaix(this.value);'>  Y=<input type="range" min="0" max="100" step="1" value="0" onclick='vaiy(this.value);'>  Z=<input type="range" min="0" max="20" step=".1" value="0" onclick='vaiz(this.value);'>  Repeat<input id="repeat" type="checkbox"><br>     <input type="text" id="lnamex">     <input type="text" id="lnamey">     <input type="text" id="lnamez"><br>   <textarea cols="70" id="gcode" rows="40" ></textarea>  <script>    const connectButton = document.getElementById('connectButton');    const ceck = document.getElementById('repeat');	var writer,tct="a",valuex="",gcode="";	var myArr=[];	var linenr=0;	let myVar = setInterval(myT ,300);	     async function myT() {     await writer.write("?\r");     }    connectButton.addEventListener('click', async () => {      try {        // Request user to select a serial port        const port = await navigator.serial.requestPort();		await port.open({ baudRate: 115200 });        // Set up stream for reading data        const textDecoder = new TextDecoderStream();        const readableStreamClosed = port.readable.pipeTo(textDecoder.writable);        reader = textDecoder.readable.getReader();		const textEncoder = new TextEncoderStream();        const writableStreamClosed = textEncoder.readable.pipeTo(port.writable);        writer = textEncoder.writable.getWriter();        // Continuously read and log data from serial port        while (true) {          const { value, done } = await reader.read();          if (done) {            reader.releaseLock();            break;          }		  valuex +=value;  if (valuex.includes('\r') || valuex.includes('\n')) {     if (valuex.includes('|')) {	 const parts = valuex.split("|");	 const coords1 = parts[1].split(":");	 const coords = coords1[1].split(",");	 document.getElementById('lnamex').value=coords[0];	 document.getElementById('lnamey').value=coords[1];	 document.getElementById('lnamez').value=coords[2];	 //console.log(coords[0]);	 //console.log(coords[1]);	 //console.log(coords[2]);	 gcode="G01 X"+coords[0]+" Y"+coords[1]+" Z"+coords[2]+"\n";	 	 valuex="";	 }  if (valuex.includes('ok')) {	 console.log(valuex);	 valuex="";	 }	if (value.indexOf("k") !=-1) {            if (myArr[linenr]) {              await writer.write(myArr[linenr] + "\r");              linenr++;			  console.log("console");			  console.log(myArr[linenr]);			   console.log(linenr); }else{if (ceck.checked) {linenr=0; } } }  }        }      } catch (error) {        console.error('Error connecting to serial port:', error);        // Handle the error appropriately (e.g., display an error message to the user)      }    });	    async function vairesult() {        await writer.write("?\r");        document.getElementById('gcode').value +=gcode;      }	  	    async function vaix(value5) {        await writer.write("G90 F1000\rG01 X"+value5+"\r");		      }	  	    async function vaiy(value5) {        await writer.write("G90 F1000\rG01 Y"+value5+"\r");		      }	  	    async function vaiz(value5) {        await writer.write("G90 F100\rG01 Z"+value5+"\r");	      }	        async function WriteSerial() {        linenr = 0;        var text = "G21 F500 G90\n";        text += document.getElementById('gcode').value;        myArr = text.split("\n");        //var len=myArr[0].length;        await writer.write(myArr[linenr] + "\r");        linenr++;        console.log(myArr);      }	    async function movexp() {		val=document.getElementById("step").value;        await writer.write("G91 F1000\rG01 X"+val+"\r");	      }	  	    async function movexm() {		val=document.getElementById("step").value;        await writer.write("G91 F1000\rG01 X-"+val+"\r");	      }	  	    async function moveyp() {		val=document.getElementById("step").value;        await writer.write("G91 F1000\rG01 Y"+val+"\r");	      }	  	    async function moveym() {		val=document.getElementById("step").value;        await writer.write("G91 F1000\rG01 Y-"+val+"\r");	      }	  	    async function movezp() {		val=document.getElementById("step").value;        await writer.write("G91 F100\rG01 Z+1\r");	      }	  	    async function movezm() {		val=document.getElementById("step").value;        await writer.write("G91 F100\rG01 Z-1\r");	      }  </script></body></html>